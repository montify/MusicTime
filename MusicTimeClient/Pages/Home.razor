@page "/"
@inject NavigationManager _navigationManager
@using Microsoft.AspNetCore.Components.Authorization
@using MusicTimeClient.Contracts
@using MusicTimeClient.Pages.Auth
@using MusicTimeClient.Pages.Entries;


<div class="justify-content-center w-100">

    <AuthorizeView>
        <Authorized>
            <MudButton OnClick="OnLoggout">Logout</MudButton>
        </Authorized>
        <NotAuthorized>
            <MudButton OnClick="@ToggleOpen">Login</MudButton>
        </NotAuthorized>
    </AuthorizeView>


    <MudPopover Class="px-4 pt-4" Open="m_Open">
        <Login OnLogginSuccess="OnLogginSuccess" />
        <MudButton OnClick="@ToggleOpen">Close</MudButton>
    </MudPopover>
    <EntryList />

</div>

@code {
    public bool m_Open;
    private void ToggleOpen() => m_Open = !m_Open;

    [Inject]
    public LocalStorage m_localStorage { get; set; }
    [Inject]
    public IAuthService AuthService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        StateHasChanged();
    }

    public void OnLogginSuccess()
    {
        m_Open = false;
        StateHasChanged();
    }

    public async void OnLoggout()
    {
        await AuthService.Logout();
        StateHasChanged();
    }
}